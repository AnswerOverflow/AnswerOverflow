// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
// naming convention: https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#naming-conventions

// General concept for laying out the fields:
// ids go first, then then fields, then at the bottom are the references to other tables
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Users

model User {
  id         String  @id
  name       String  @db.VarChar(32)
  email      String? @db.VarChar(320)
  avatar     String? @db.VarChar(45)
  created_at Int?

  user_channel_settings UserChannelSettings[]
  user_server_settings  UserServerSettings[]
}

model UserChannelSettings {
  user_id    String
  channel_id String
  settings   Int

  user    User    @relation(fields: [user_id], references: [id])
  channel Channel @relation(fields: [channel_id], references: [id])

  @@id([user_id, channel_id])
}

model UserServerSettings {
  user_id     String
  server_id   String
  permissions Int

  user   User   @relation(fields: [user_id], references: [id])
  server Server @relation(fields: [server_id], references: [id])

  @@id([user_id, server_id])
}

model DeletedUser {
  deleted_user_id String @id
}

// Servers

model Server {
  id          String    @id
  name        String    @db.VarChar(100)
  icon        String?   @db.VarChar(45)
  kicked_time DateTime?

  user_server_settings UserServerSettings[]
  channels             Channel[]
}

model ServerSettings {
  server_id   String @id
  permissions Int
}

// Channels

model Channel {
  id        String @id
  server_id String
  name      String @db.VarChar(100)
  type      Int

  server                Server                @relation(fields: [server_id], references: [id])
  user_channel_settings UserChannelSettings[]
  channel_settings      ChannelSettings[]
  ForumChannelTag       ForumChannelTag[]
}

model ChannelSettings {
  channel_id             String  @id
  permissions            Int
  last_indexed_snowflake String?
  invite_code            String? @db.VarChar(15)
  solution_tag_id        String?

  channel Channel @relation(fields: [channel_id], references: [id])
}

model ForumChannelTag {
  id         String
  channel_id String
  channel    Channel @relation(fields: [channel_id], references: [id])
  name       String  @db.VarChar(20)

  @@id([id, channel_id])
}
